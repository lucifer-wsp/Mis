<html>
    <link rel="icon" href="./Icon/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="./DataTables-1.10.15/media/css/jquery.dataTables.min.css"/>
    <link rel='stylesheet' type='text/css' href='./css/buttons.css' />
    <title>Splovem</title>
    <head>
        <script src='./JQuery/jquery-3.2.1.min.js' type='text/javascript'></script>
        <script type="text/javascript" src="./DataTables-1.10.15/media/js/jquery.dataTables.min.js"></script>
        <script>
            $(document).ready(
                function(){
                    $('#dg').DataTable();
                    $("#search_btn").click(
                        function(){
                            $("#sel_all").prop('checked',false);
                            var pid_value = $("#keyword_txt").val();
                            if(!pid_value || true != check_in(pid_value)){
                                alert('input error, format must be 18812345678 or 029-12345678');
                                return ;
                            }
                            post_req(pid_value);
                            console.log('search');
                        }
                    );
                    $("#sel_all").click(
                        function(){
                            console.log('select all.');
                            var data = $("#dg").DataTable().rows().data();
                            console.log(data);
                        }
                    );
                    $("#print_btn_cls").click(
                        function (){
                            console.log('print');
                        }
                    );
                }
            );

            $(window).on('load', function (){
                //console.log('load');
                var loc_url = location.href + "";
                if(loc_url.indexOf('?') > -1){
                    var param = loc_url.split('?')[1].split('&')[0];
                    var pid_name = param.split('=')[0].trim();
                    var pid_value = param.split('=')[1].trim();

                    if('pid' != pid_name || !check_in(pid_value)){
                        return ;
                    }
                    $("#keyword_txt").val(pid_value);
                    post_req(pid_value);
                }
            });

            function check_in(pid){
                var chk_phone = {chk_mobile: /^0?1[3|4|5|8|7][0-9]\d{8}$/,
                                chk_tel: /^0[\d]{2,3}-[\d]{7,8}$/};

                if(pid && (chk_phone.chk_mobile.test(pid) || chk_phone.chk_tel.test(pid))){
                    return true;
                }
                return false;
            }

            function post_req(pid_value){
                if(pid_value){
                    //$.post("http://www.splovem.com/search", {pid: pid_value}, function(result){
                        //var data = result.result;
                        var data = [{'pid':18710619804,'detail_info':'1','timestamp': '2017-09-14 10:00:00'}, 
                                    {'pid':18710619804,'detail_info':'1','timestamp': '2017-09-14 10:00:00'},
                                    {'pid':18710619804,'detail_info':'1','timestamp': '2017-09-14 10:00:00'},
                                    {'pid':18710619804,'detail_info':'1','timestamp': '2017-09-14 10:00:00'},
                                    {'pid':18710619804,'detail_info':'1','timestamp': '2017-09-14 10:00:00'},
                                    {'pid':18710619804,'detail_info':'1','timestamp': '2017-09-14 10:00:00'}];

                        for(var i = 0;i < data.length; i++){
                            data[i]['chk_sel'] = '<input type="checkbox" style="text-align: center;" onclick="row_click()" />';
                        }
                        console.log(data);
                        
                        $('#dg').DataTable({
                            searching: false,
                            sorting: false,
                            destroy: true,
                            "bSort" : false,
                            "bProcessing" : true,  
                            'cell-border': true,
                            data:data,
                            columns: [
                                {data: 'chk_sel'},
                                {data: 'pid'},
                                {data: 'detail_info'},
                                {data: 'timestamp'}
                            ]

                        });
                    //});
                }
            }

            function row_click(){
                console.log('row_click.');
            }
        </script>
        <style>
            .search_btn_cls { width: 45%; height: 28px; border: none; background: #00a57f; outline: none; }
            .search_btn_cls:hover {background: #00b38a;}
            .print_btn_cls { width: 250px; height: 65px; border: none; background: #00a57f; outline: none; font-size: 25px; font-family: "Helvetica Neue Light", "Helvetica Neue", "Helvetica", "Arial", "Lucida Grande", "sans-serif"; }
            .print_btn_cls:hover {background: #00b38a;}
        </style>
    </head>

    <body>
        <meta http-equit='Access-Control-Allow-Origin' content='*' />
        <div id='top' style='' >
            <div style='float: left; width: 30%; '>
                <a href='./index.html'><img src='./Icon/splmm.ico' style='width: 20%;' /></a>
            </div>
            <div style='float: left; width: 60%; hight: 50px; position: absolute; top: 30px; right: 0px;'>
                <div style='float:left; width: 65%; border: #00a57f solid 0px; text-align: right;'>
                    <input id='keyword_txt' type='text' style='height: 28px; width:55%; font-size: 16px; border: #00a57f solid 2px; outline: none;' />
                </div>
                <div style='float:left; width: 25%; border: green solid 0px; text-align: left;'>
                    <button id='search_btn' type='button' class='search_btn_cls' clickon=''/>查一查</button>
                </div>
            </div>
        </div>

        <div id='body' style='position: absolute; top: 150px; width: 99%;border: green solid 0px;'>
            <table id="dg" title="" class='demo display dataTable' style="width:99%;height:250px; border: solid 1px; text-align: center; " >
                <thead>
                    <tr>
                        <th data-options="field:'chk'" style='width: 20%'>
                            <input type='checkbox' id='sel_all' style='text-align: center;color: green;' />
                        </th>
                        <th data-options="field:'phone number'" style='width: 20%'>电话号码</th>
                        <th data-options="field:'detail info',align:'center'" style='width: 40%'><font background='red'>个人信息</font></th>
                        <th data-options="field:'time stamp',align:'center'" style='width: 20%'>时间</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <div style='text-align: center;'>
                <input type='button' class='print_btn_cls' value='打印选中' />
            </div>
        </div>

        <div id='footer' style='position: absolute; bottom: 20px; left: 20px;'>
            <a href='' style='text-decoration: none; color: #00a57f; font-size: 13px;'>关于我们</a>
            <a href='' style='text-decoration: none; color: #00a57f; font-size: 13px;'>联系我们</a>
        </div>
    </body>
</html>